<!-- src: https://bl.ocks.org/vasturiano/2f602ea6c51c664c29ec56cbe2d6a5f6 -->
<head>
    <script src="//unpkg.com/3d-force-graph"></script>

    <style>
        body { margin: 0; }
    </style>
</head>

<body>
    <h1>Thinkspace</h1>
    <div id="3d-graph"></div>

    <script>
        const initData = {
            nodes: [ {id: 0 } ],
            links: []
        };
        
        const elem = document.getElementById("3d-graph");
        
        const Graph = ForceGraph3D()(elem)
                .enableNodeDrag(false)
                .onNodeHover(node => elem.style.cursor = node ? 'pointer' : null)
                .onNodeClick(addNode)
                .onBackgroundClick(addLinklessNode)
                .graphData(initData);

        // setInterval(() => {
        //     const { nodes, links } = Graph.graphData();
        //     const id = nodes.length;
        //     Graph.graphData({
        //         nodes: [...nodes, { id }],
        //         links: [...links, { source: id, target: Math.round(Math.random() * (id-1)) }]
        //     });
        // }, 1000);

        // addNode
        function addNode(node){
            const {nodes, links} = Graph.graphData();
            const id = nodes.length;
            Graph.graphData({
                nodes: [...nodes, { id }],
                links: [...links, {source: node.id, target: id}]
            });
        }

        function addLinklessNode(){
            const {nodes, links} = Graph.graphData();
            const id = nodes.length;
            Graph.graphData({
                nodes: [...nodes, { id }],
                links: [...links]
            });
        }





        // removeNode
        function removeNode(node) {
            let { nodes, links } = Graph.graphData();
            // console.log('print')
            // console.log(nodes,links)
            links = links.filter(l => l.source !== node && l.target !== node); // Remove links attached to node
            nodes.splice(node.id, 1); // Remove node
            nodes.forEach((n, idx) => { n.id = idx; }); // Reset node ids to array index
            Graph.graphData({ nodes, links });
        }
    </script>
</body>